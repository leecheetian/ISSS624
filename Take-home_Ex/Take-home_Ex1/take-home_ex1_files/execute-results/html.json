{
  "hash": "055e5dc8deab24bba16c184e08dae977",
  "result": {
    "markdown": "---\ntitle: \"Take-home Exercise 1\"\nauthor: \"Lee Chee Tian\"\neditor: visual\n---\n\n\n# Geospatial Analytics for Social Good\n\n## Objective\n\nTo reveal the geospatial patterns of Not Functional water points in Nigeria using global and local spatial association techniques.\n\n## Loading R Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spdep, tmap, tidyverse)\n```\n:::\n\n\n## Importing Data into R\n\n### The Data\n\n![](nigeria%20adm2%20geospatial%20data.jpg)\n\n![](nigeria%20aspatial%20data.jpg)\n\nAs the size of the CSV file has exceeded the GitHub limitation of 100 MB, it shall not be included in the Commit and Push to GitHub and Netlify. The wrangled data derived from the following steps for the subsequent geospatial analysis will be exported as a RDS file, and this will be pushed to GitHub and Netlify instead.\n\n### Importing shapefile and Transforming to EPSG 26391 Map Projection\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria_sf <- st_read(dsn=\"data/Nigeria\", layer=\"geoBoundaries-NGA-ADM2\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `geoBoundaries-NGA-ADM2' from data source \n  `D:\\SMU\\ISSS624 - Applied Geospatial Analytics\\exercises\\leecheetian\\ISSS624\\Take-home_Ex\\Take-home_Ex1\\data\\Nigeria' \n  using driver `ESRI Shapefile'\nSimple feature collection with 774 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2.668534 ymin: 4.273007 xmax: 14.67882 ymax: 13.89442\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(nigeria_sf)\n```\n\n::: {.cell-output-display}\n![](take-home_ex1_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(nigeria_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 774\nColumns: 6\n$ shapeName  <chr> \"Aba North\", \"Aba South\", \"Abadam\", \"Abaji\", \"Abak\", \"Abaka…\n$ Level      <chr> \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"AD…\n$ shapeID    <chr> \"NGA-ADM2-72505758B79815894\", \"NGA-ADM2-72505758B67905963\",…\n$ shapeGroup <chr> \"NGA\", \"NGA\", \"NGA\", \"NGA\", \"NGA\", \"NGA\", \"NGA\", \"NGA\", \"NG…\n$ shapeType  <chr> \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"ADM2\", \"AD…\n$ geometry   <MULTIPOLYGON [°]> MULTIPOLYGON (((7.401109 5...., MULTIPOLYGON (…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria26391 <- st_transform(nigeria_sf, crs = 26391)\nnigeria26391\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 774 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 28879.72 ymin: 30292.37 xmax: 1343798 ymax: 1094244\nProjected CRS: Minna / Nigeria West Belt\nFirst 10 features:\n        shapeName Level                    shapeID shapeGroup shapeType\n1       Aba North  ADM2 NGA-ADM2-72505758B79815894        NGA      ADM2\n2       Aba South  ADM2 NGA-ADM2-72505758B67905963        NGA      ADM2\n3          Abadam  ADM2 NGA-ADM2-72505758B57073987        NGA      ADM2\n4           Abaji  ADM2 NGA-ADM2-72505758B61968000        NGA      ADM2\n5            Abak  ADM2 NGA-ADM2-72505758B39432389        NGA      ADM2\n6       Abakaliki  ADM2 NGA-ADM2-72505758B36739173        NGA      ADM2\n7  Abeokuta North  ADM2 NGA-ADM2-72505758B86358915        NGA      ADM2\n8  Abeokuta South  ADM2 NGA-ADM2-72505758B56925175        NGA      ADM2\n9             Abi  ADM2  NGA-ADM2-72505758B1616690        NGA      ADM2\n10    Aboh-Mbaise  ADM2 NGA-ADM2-72505758B78555816        NGA      ADM2\n                         geometry\n1  MULTIPOLYGON (((552560.3 12...\n2  MULTIPOLYGON (((545153.6 12...\n3  MULTIPOLYGON (((1245549 106...\n4  MULTIPOLYGON (((510602.3 57...\n5  MULTIPOLYGON (((598086 1218...\n6  MULTIPOLYGON (((663801.7 25...\n7  MULTIPOLYGON (((81132.88 37...\n8  MULTIPOLYGON (((98464.54 34...\n9  MULTIPOLYGON (((635478 2187...\n10 MULTIPOLYGON (((543608.8 15...\n```\n:::\n:::\n\n\n### Importing Aspatial Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nWPdx_csv <- read_csv(\"data/WPdx+/Water_Point_Data_Exchange_-_Plus__WPdx__.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: One or more parsing issues, call `problems()` on your data frame for details,\ne.g.:\n  dat <- vroom(...)\n  problems(dat)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 406566 Columns: 70\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (43): #source, #report_date, #status_id, #water_source_clean, #water_sou...\ndbl (23): row_id, #lat_deg, #lon_deg, #install_year, #fecal_coliform_value, ...\nlgl  (4): #rehab_year, #rehabilitator, is_urban, latest_record\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\n#### Data Wrangling\n\nRetrieving data for Nigeria only and where functional status is known.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria_data <- WPdx_csv %>%\n  filter(`#country_name` == \"Nigeria\") %>%\n  drop_na(`#status`) %>%\n  group_by(`#adm2`) %>%\n  mutate(`functionality` = case_when(grepl(\"^Functional\", `#status`) \n                                     ~ \"Functional\", \n                                     TRUE ~ \"Non-functional\")) %>%\n  count(`functionality`) %>%\n  pivot_wider(names_from = `functionality`, values_from = n) %>%\n  mutate(`f2nfrate` = ifelse(!is.na(`Functional`) & !is.na(`Non-functional`), \n                             `Functional` / `Non-functional`,\n                              ifelse(!is.na(`Functional`), \n                                     `Functional`, 0)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria_data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 749 × 4\n# Groups:   #adm2 [749]\n   `#adm2`        Functional `Non-functional` f2nfrate\n   <chr>               <int>            <int>    <dbl>\n 1 Aba South              33               16    2.06 \n 2 Abaji                  33               36    0.917\n 3 Abak                   22               25    0.88 \n 4 Abakaliki              71               34    2.09 \n 5 Abeokuta North         11                8    1.38 \n 6 Abeokuta South         75               39    1.92 \n 7 Abi                    79               60    1.32 \n 8 Abia North              6               28    0.214\n 9 Aboh-Mbaise            18               26    0.692\n10 Abua/Odual             25               13    1.92 \n# … with 739 more rows\n```\n:::\n:::\n\n\nThe following assumptions were taken in the calculation of the Functional-to-Non-functional ratio, *f2nfrate*, of the water points in each Local Government Area (LGA):\n\n-   For LGAs with both Functional and Non-functional water point records, the *f2nfrate* is calculated by the count of the former divided by the count of the latter.\n\n-   For LGAs with only Functional water point records but no Non-functional water point records, the *f2nfrate* is assigned the count of the Functional water points (ie. assuming the Non-functional water point count is 1), as it is not feasible to divide by 0.\n\n-   For LGAs with only Non-functional water point records and no Functional water point records, the *f2nfrate* is assigned as 0.\n\n### Joining the Aspatial Data and the Geospatial Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria_WPdx <- left_join(nigeria26391, nigeria_data, \n                          by = c(\"shapeName\" = \"#adm2\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria_WPdx\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 774 features and 8 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 28879.72 ymin: 30292.37 xmax: 1343798 ymax: 1094244\nProjected CRS: Minna / Nigeria West Belt\nFirst 10 features:\n        shapeName Level                    shapeID shapeGroup shapeType\n1       Aba North  ADM2 NGA-ADM2-72505758B79815894        NGA      ADM2\n2       Aba South  ADM2 NGA-ADM2-72505758B67905963        NGA      ADM2\n3          Abadam  ADM2 NGA-ADM2-72505758B57073987        NGA      ADM2\n4           Abaji  ADM2 NGA-ADM2-72505758B61968000        NGA      ADM2\n5            Abak  ADM2 NGA-ADM2-72505758B39432389        NGA      ADM2\n6       Abakaliki  ADM2 NGA-ADM2-72505758B36739173        NGA      ADM2\n7  Abeokuta North  ADM2 NGA-ADM2-72505758B86358915        NGA      ADM2\n8  Abeokuta South  ADM2 NGA-ADM2-72505758B56925175        NGA      ADM2\n9             Abi  ADM2  NGA-ADM2-72505758B1616690        NGA      ADM2\n10    Aboh-Mbaise  ADM2 NGA-ADM2-72505758B78555816        NGA      ADM2\n   Functional Non-functional  f2nfrate                       geometry\n1          NA             NA        NA MULTIPOLYGON (((552560.3 12...\n2          33             16 2.0625000 MULTIPOLYGON (((545153.6 12...\n3          NA             NA        NA MULTIPOLYGON (((1245549 106...\n4          33             36 0.9166667 MULTIPOLYGON (((510602.3 57...\n5          22             25 0.8800000 MULTIPOLYGON (((598086 1218...\n6          71             34 2.0882353 MULTIPOLYGON (((663801.7 25...\n7          11              8 1.3750000 MULTIPOLYGON (((81132.88 37...\n8          75             39 1.9230769 MULTIPOLYGON (((98464.54 34...\n9          79             60 1.3166667 MULTIPOLYGON (((635478 2187...\n10         18             26 0.6923077 MULTIPOLYGON (((543608.8 15...\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(nigeria_WPdx, \"data/rds/nigeria_WPdx.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria_WPdx <- read_rds(\"data/rds/nigeria_WPdx.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnigeria_WPdx\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 774 features and 8 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 28879.72 ymin: 30292.37 xmax: 1343798 ymax: 1094244\nProjected CRS: Minna / Nigeria West Belt\nFirst 10 features:\n        shapeName Level                    shapeID shapeGroup shapeType\n1       Aba North  ADM2 NGA-ADM2-72505758B79815894        NGA      ADM2\n2       Aba South  ADM2 NGA-ADM2-72505758B67905963        NGA      ADM2\n3          Abadam  ADM2 NGA-ADM2-72505758B57073987        NGA      ADM2\n4           Abaji  ADM2 NGA-ADM2-72505758B61968000        NGA      ADM2\n5            Abak  ADM2 NGA-ADM2-72505758B39432389        NGA      ADM2\n6       Abakaliki  ADM2 NGA-ADM2-72505758B36739173        NGA      ADM2\n7  Abeokuta North  ADM2 NGA-ADM2-72505758B86358915        NGA      ADM2\n8  Abeokuta South  ADM2 NGA-ADM2-72505758B56925175        NGA      ADM2\n9             Abi  ADM2  NGA-ADM2-72505758B1616690        NGA      ADM2\n10    Aboh-Mbaise  ADM2 NGA-ADM2-72505758B78555816        NGA      ADM2\n   Functional Non-functional  f2nfrate                       geometry\n1          NA             NA        NA MULTIPOLYGON (((552560.3 12...\n2          33             16 2.0625000 MULTIPOLYGON (((545153.6 12...\n3          NA             NA        NA MULTIPOLYGON (((1245549 106...\n4          33             36 0.9166667 MULTIPOLYGON (((510602.3 57...\n5          22             25 0.8800000 MULTIPOLYGON (((598086 1218...\n6          71             34 2.0882353 MULTIPOLYGON (((663801.7 25...\n7          11              8 1.3750000 MULTIPOLYGON (((81132.88 37...\n8          75             39 1.9230769 MULTIPOLYGON (((98464.54 34...\n9          79             60 1.3166667 MULTIPOLYGON (((635478 2187...\n10         18             26 0.6923077 MULTIPOLYGON (((543608.8 15...\n```\n:::\n:::\n\n\n## Plotting Thematic Map of Water Point Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfmap <- tm_shape(nigeria_WPdx) +\n  tm_polygons(\"Functional\", title = \"Functional count\", \n              style = \"jenks\", palette = \"Blues\", n = 6, border.alpha = 0.5) +\n  tm_layout(legend.outside = TRUE)\n  \nnfmap <- tm_shape(nigeria_WPdx) +\n  tm_polygons(\"Non-functional\", title = \"Non-functional count\", \n              style = \"jenks\", palette = \"Oranges\", n = 6, border.alpha = 0.5) +\n  tm_layout(legend.outside = TRUE)\n\nf2nfmap <- tm_shape(nigeria_WPdx) +\n  tm_polygons(\"f2nfrate\", title = \"Functional to Non-functional ratio\", \n              style = \"jenks\", palette = \"Greens\", n = 6, border.alpha = 0.5) +\n  tm_layout(legend.outside = TRUE) \n\ntmap_arrange(fmap, nfmap, f2nfmap, ncol=1)\n```\n\n::: {.cell-output-display}\n![](take-home_ex1_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nIt appears the functional water points are mostly concentrated in the northern regions of Nigeria, and corresponds to a higher functional-to-non-functional ratio. The central and southern regions see a higher number of non-functional water points and lower functional-to-non-functional ratio in contrast.\n\n## Cluster and Outlier Analysis\n\n### Computing Contiguity Spatial Weights\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwm_q <- poly2nb(nigeria_WPdx, queen = TRUE)\nsummary(wm_q)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNeighbour list object:\nNumber of regions: 774 \nNumber of nonzero links: 4440 \nPercentage nonzero weights: 0.7411414 \nAverage number of links: 5.736434 \n1 region with no links:\n86\nLink number distribution:\n\n  0   1   2   3   4   5   6   7   8   9  10  11  12  14 \n  1   2  14  57 125 182 140 122  72  41  12   4   1   1 \n2 least connected regions:\n138 560 with 1 link\n1 most connected region:\n508 with 14 links\n```\n:::\n:::\n\n\n### Row-Standardized Weights Matrix\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrswm_q <- nb2listw(wm_q, style = \"W\", zero.policy = TRUE)\nprint(rswm_q, zero.policy = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCharacteristics of weights list object:\nNeighbour list object:\nNumber of regions: 774 \nNumber of nonzero links: 4440 \nPercentage nonzero weights: 0.7411414 \nAverage number of links: 5.736434 \n1 region with no links:\n86\n\nWeights style: W \nWeights constants summary:\n    n     nn  S0       S1       S2\nW 773 597529 773 285.0658 3198.414\n```\n:::\n:::\n\n\n### Global Spatial Autocorrelation: Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoran.test(nigeria_WPdx$f2nfrate, \n           listw = rswm_q, \n           zero.policy = TRUE, \n           na.action = na.omit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tMoran I test under randomisation\n\ndata:  nigeria_WPdx$f2nfrate  \nweights: rswm_q \nomitted: 1, 3, 16, 30, 37, 40, 58, 62, 63, 91, 112, 136, 145, 146, 150, 186, 187, 188, 202, 210, 211, 212, 224, 232, 235, 244, 250, 261, 262, 268, 271, 276, 284, 287, 296, 313, 328, 335, 341, 342, 357, 364, 365, 368, 385, 387, 394, 396, 397, 400, 406, 416, 421, 424, 439, 447, 460, 473, 475, 478, 491, 492, 496, 509, 521, 525, 526, 529, 542, 548, 553, 566, 567, 570, 572, 591, 622, 623, 624, 626, 627, 641, 647, 659, 728, 732, 736, 757, 759, 770 n reduced by no-neighbour observations\n  \n\nMoran I statistic standard deviate = 7.8123, p-value = 2.808e-15\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n     0.1753148604     -0.0014662757      0.0005120523 \n```\n:::\n:::\n\n\nThe positive Moran's I value of 0.1753 and low p-value of \\< 0.05 suggest that there is clustering and positive spatial autocorrelation of the functional-to-non-functional ratio of the water points among the LGAs, and the null hypothesis of spatial randomness is rejected.\n",
    "supporting": [
      "take-home_ex1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}